#第一章 计算机系统漫游#

计算机系统是由**硬件**和**系统软件**组成的。

##1.1 信息就是位+上下文##

- 源程序实际上是由0和1组成的位序列（比特序列）
- 8个位被组织成一组，称为**字节**
- 每个字节表示程序中的文本字符
- ASCII码是用唯一的一个单字节大小的整数值来表示每个字符
- 源程序是以字节序列的方式存储在文件中的
- 像hello.c这样只由ASCII字符构成的文件，称为**文本文件**；其他所有文件都称为**二进制文件**

对于“信息就是位+上下文”这句话的解释：

系统中所有的信息，其实都是由一串比特构成的。我们区分不同数据对象的方法就是利用这些数据对象的上下文。

##1.2 程序，被其他程序翻译成不同的格式##

hello.c程序被gcc编译程序读取并翻译，最终翻译成一个可执行文件hello。

其翻译步骤分为**预处理器、编译器、汇编器、链接器**四个阶段，统称为**编译系统**。

1. 源程序：程序员编写的hello.c（hello.c是文本文件）

2. 预处理阶段：预处理器（cpp）根据以字符#开头的命令，修改原始的hello.C程序。也就是，将#开头的命令直接插入程序文本中，最终得到hello.i文件。（hello.i是文本文件）

3. 编译阶段：编译器（ccl）将hello.i文件翻译成hello.s文件。hello.s中包含了一个汇编语言程序，该程序中包含了main函数的定义。（hello.s是文本文件）

4. 汇编阶段：汇编器（as）将hello.s文件翻译成机器语言指令，然后将这些指令打包成一种格式（可重定位目标程序），并将打包结果保存在hello.o文件中。（hello.o是二进制文件）

5. 链接阶段：链接器（ls)将程序中用到的库函数合并到hello.o文件中，得到hello文件。hello文件是可执行目标文件（简称，可执行文件），可被加载到内存中，由系统执行。

##1.3 系统的硬件组成##

1. **总线**：贯穿真个系统的一组电子通道，它携带信息字节，并负责在各个部件之间传递信息。总线传输的单位是固定的字节块，称为**字**。字中的字节数叫字长。字长因系统的不同而不同。一般情况下，32位操作系统的字长是4个字节，64位操作系统的字长是8个字节。

2. **I/O设备（输入输出设备）**：I/O设备有两种分类：一种分类是块设备（如硬盘、U盘、CD-ROM）和字符设备（如键盘、鼠标、打印机）；一种分类是存储设备（如硬盘）、传输设备 （如网卡、调制解调器）、人机交互设备（如键盘、鼠标、显示器）。每个I/O设备都通过控制器或者适配器与I/O总线相连。控制器和适配器的区别在于他们的封装方式：控制器是I/O设备本身或者系统主板上的芯片组；适配器是插在主板插槽上的卡。

3. **主存（内存）**：临时存储设备，存放程序和程序处理的数据，是CPU能直接寻址的地址空间。从物理上来看，主存是由一组DRAM芯片组成的；从逻辑上看，主存是一个线性字节数组，每个字节都有唯一的地址（数组索引），且地址从0开始。

4. **处理器（CPU）**：执行存储在内存中的指令。CPU的核心是程序计数器（PC），程序计数器是大小为一个字的寄存器。

##1.4 存储设备的层次结构##

寄存器 → 高速缓存 → 内存  → 外存

- 高层次的存储设备读取速度更快，单位造价也更高
- 高层次的存储设备可以作为低层次存储设备的高速缓存

##1.5 操作系统管理硬件##

操作系统可以看做是应用程序和硬件之间插入的一层软件，主要有两个功能：

- 防止硬件被不受控制的应用程序滥用
- 向应用程序提供简单一致的机制来控制复杂而又通常不大相同的低级硬件设备

操作系统提供了三种抽象：

- **文件是对I/O设备的抽象**
- **虚拟内存是对内存和磁盘I/O设备的抽象**
- **进程是对处理器、内存和磁盘I/O设备的抽象**


1. 进程是对一个正在执行的程序的抽象。一个进程可以包含多个线程，线程共享同样的代码和全局数据。
2. 虚拟内存为进程提供了一种假象，即每个进程都在独占地使用内存。每个进程看到的内存都是一致的，称为虚拟地址空间。
3. 文件是字节序列。所有的输入输出操作，都是系统函数——Unix I/O函数调用读写文件实现的。

##1.6 几个重要的概念##

###1.6.1 Amdahl 定律###

Amdahl 定律：当我们对系统的某个部分加速时，其对系统的整体性能影响取决于该部分的重要性和加速程度。

若系统执行某应用程序的时间为T<sub>old</sub>。假设系统某部分所需执行时间与该时间的比例为α，即该部分初始所需的执行时间为αT<sub>old</sub>。若该部分性能提升比例为k，则其现在所需时间为（αT<sub>old</sub>）/ k，则总的执行时间为：

T<sub>new</sub> = （1-α）T<sub>old</sub> + （αT<sub>old</sub>）/ k = [(1-α）+ α/k] T<sub>old</sub>

可得加速比 S = T<sub>old</sub> / T<sub>new</sub>，即**S = 1 / [(1-α）+ α/k]**

###1.6.2 并发和并行###

线程级并发、指令级并行、单指令多数据并行

###1.6.3 计算机系统中抽象的重要性###

- 指令集架构是对处理器硬件的抽象
- 文件是对I/O设备的抽象
- 虚拟内存是对I/O设备和内存的抽象
- 进程是对I/O设备、内存和处理器的抽象
- 虚拟机是对操作系统、I/O设备、内存和处理器的抽象

##小结##

- 计算机系统是硬件和系统软件的组合。
- 计算机中的信息实质上就是位序列，它们根据上下文的不同而有不同的解释。
- 程序被其他程序翻译成不同形式的形式，开始是ASCII码文件，后来被编译器和链接器翻译成二进制文件。
- 处理器CPU负责读取并解释存储在内存中的指令。
- 存储设备分为层次结构，最上面的是CPU寄存器，其次是高速缓存cache、内存，最后是磁盘。在层次模型中，高层次的存储设备更快，单位比特造价更高；此外，高层次的存储设备可以作为低层次存储设备的高速缓存。
- 操作系统是应用程序和计算机硬件之间的软件，它提供进程、虚拟内存和文件三个抽象。
- 网络是计算机系统之间通信的手段。从某种意义上来看，网络也属于I/O设备。